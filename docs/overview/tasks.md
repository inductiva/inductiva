# Tasks

The **Inductiva API** client provides the ability to run complex simulations and
contains easy-to-use tools to manage them. Each simulation was submitted - with
`simulator.run()` - runs asynchronously and returns a `Task` object that contains
methods to manage the simulation.

Here, you'll learn:

- [Managing tasks](#managing-tasks): the methods you can use to interact with a 
specific task.
- [Retrieving tasks from previous sessions](#retrieving-tasks-from-previous-sessions): 
getting information from previously run tasks.

## Managing tasks

The `Task` class provides methods for managing a specific task submitted to 
the **Inductiva API**. You get an instance of `Task` everytime you create a 
simulation. Moreover, you can [retrieve previously created tasks](#retrieving-tasks-from-previous-sessions).
With a `Task` object, you can:
 * Get its status;
 * Get the machine type where it ran/is running;
 * Kill it if you've changed your mind;
 * Turning it into a blocking call;
 * Download output files (all of them or only the important ones);
 * Get its execution time.

### Examples:

```python
# Launch a Reef3D simulation as in previous examples.
import inductiva

input_dir = inductiva.utils.download_from_url(
    "https://storage.googleapis.com/inductiva-api-demo-files/"
    "reef3d-input-example.zip", unzip=True
)
simulator = inductiva.simulators.REEF3D()
task = simulator.run(input_dir=input_dir)

# Get status of the task.
status = task.get_status()
print(status) # would be, e.g., "submitted", "started", "success", "failed", "killed"

# Get the machine type where the task is running.
machine_type = task.get_machine_type()
print(machine_type) # e.g., "c2-standard-4", "c2d-standard-16"

# Kill a task that hasn't completed yet.
if status == "submitted" or status == "started":
    task.kill()
```

```python

# Block the call until the simulation completes, but
# without interrupting the remote task if the local process
# is interrupted. 
task.wait()

# Or turn the simulation into a blocking call. Users kill
# the remote process if the local process is killed.
with task.sync_context():
    task.wait()
```


```python

# If you don't know the files generated by your task, you can get an object
# representing information on the output files.
outputs_info = task.get_output_files_info()
full_download_size = outputs_info.size # Size of the full output archive.
files = outputs_info.contents # List of individual files available.

# Pretty print information on the output archive.
print(outputs_info)
```
```bash
# Archive size: 1.64 GiB
# Contents:
#  Size         Compressed   Name
#  191 B        96 B         stderr.txt
#  138.24 KiB   16.73 KiB    stdout.txt
# ...
#  3.80 MiB     3.61 MiB     important_file1.txt
#  1.27 MiB     1.21 MiB     important_file2.txt
```

```python
# Download all the generated files.
output_dir = task.download_outputs()

# Download only those you are interested in:
output_dir = task.download_outputs(
    filenames=["stdout.txt", "stderr.txt"])

# Or all the generated files for archival, without extracting the
# downloaded zip.
output_dir = task.download_outputs(uncompress=False)
```

## Retrieving tasks from previous sessions

A fundamental aspect of the API is that all tasks run asynchronously.
To retrieve previously created tasks and reconstruct the `Task` objects - the 
object you get from `scenario.simulate()` -  use the `inductiva.tasks.get()` 
function.
It requires an argument named `last_n`, which specifies the number of most recent 
tasks submitted to the API to retrieve. It returns a list of `Task` objects so 
that you can resume manipulating the task and its results.
Additionally, you can filter tasks by their current status, which allows you to 
get, for instance, only tasks that failed or only
tasks that are submitted and not yet started.

### Examples:

```python
import inductiva

# Get my last 10 submitted tasks.
tasks = inductiva.tasks.get(last_n=10)

# Get my last 10 tasks that ran successfuly.
tasks = inductiva.tasks.get(last_n=10, status="success")

# You can use the task objects to manipulate the tasks.
not_started_tasks = inductiva.tasks.get(last_n=5, status="submitted")
for task in not_started_tasks:
    task.kill()

successful_tasks = inductiva.tasks.get(last_n=20, status="success")
for task in successful_tasks:
    task.download_outputs()
```

You can also get the tasks using command line prompts. For example, in
you terminal, using `inductiva tasks list -n 3` should give you:

```bash

       ID                              SIMULATOR          STATUS         SUBMITTED              STARTED                COMPUTATION TIME         RESOURCE TYPE
       n7pbtxunxqzuca6nwe9v0gn75       splishsplash       success        01 Feb, 17:16:17       01 Feb, 17:16:30       0:00:10                  c2-standard-16
       bgnu9i6st2qk9ocghu6w81v5t       reef3d             success        31 Jan, 16:49:14       31 Jan, 16:50:04       0:00:16                  c2d-standard-16
       3m3u1z7rypt0o302ci6x49f46       reef3d             success        31 Jan, 16:49:13       31 Jan, 16:50:04       0:00:15                  c2d-standard-16


```