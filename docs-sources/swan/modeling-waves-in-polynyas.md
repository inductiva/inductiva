# Modeling Waves in Antarctic Polynyas
In this tutorial, we demonstrate how to use the Inductiva API to run a series of SWAN simulations that replicate scenarios from the study: *Herman, A., & Bradtke, K. (2023). SWAN wave model simulations of the Terra Nova Bay Polynya*.

This example is particularly compelling because it walks through a **complete scientific modeling workflow** — from preparing real-world data, to running simulations, to validating the results. Simulating wave growth in Antarctic polynyas is a complex challenge due to the combination of strong offshore winds, rapidly forming frazil and grease ice, and sharp spatial gradients between open water and ice-covered regions. These conditions require precise input preparation and careful parameter tuning, as even small changes can significantly affect the simulated wave spectra and their agreement with satellite observations.

Using Inductiva, such studies can be greatly streamlined. Once your input data is prepared, you can run multiple simulations in parallel on high-performance cloud machines — with minimal scripting effort. This significantly reduces the time needed to complete large-scale simulation studies, helping you move faster from model to results.

In this tutorial, we’ll focus on two key simulation scenarios:
- **S0** — Open water baseline (no ice effects). This is used to generate reference spectra for comparison with ice-affected simulations.
- **S2_f5** — Full ice scenario, where frazil and grease ice are included, and an ice-related dissipation term is activated with a specific parameter setting (power-law exponent = 5).

Let's get started!

## Setup the Simulation

### Prerequisites
1. **Download the input data** [here](https://zenodo.org/records/8308164). The files are compatible with SWAN version 41.45.

After unzipping, the folder structure should look like this:

```
SWAN_TerraNovaBayPolynya_files/
  ├── Tp_from_satellite_swangrid/
  └── swan/
       ├── input/
       ├── S0/
       └── S2_f5/
```

2. **Extract the required files**. For this tutorial, you only need:
- The `input/` folder (wind, ice concentration, and grid data)
- `.swn` input files from `S0/` and `S2_f5/` (one per polynya event)

Copy them into a new folder `tutorial/` as follows:

```
tutorial/
  └── polynya/
       ├── input/
       ├── S0/
       │    ├── polynya2D_20161005.swn
       │    ├── ...
       └── S2_f5/
            ├── polynya2D_20161005.swn
            ├── ...
```

> The `Tp_from_satellite_swangrid` folder contains satellite-derived peak periods and directions, interpolated onto the SWAN grid. These were used in the original study to validate and calibrate the model (bias, RMSD, spectral tail comparisons), but are not required for this tutorial.

### Folder Summary
Here’s what the main folders contain:
swan/input: Grid definitions, wind fields, and ice concentration maps for 10 polynya events. These are the physical inputs for your SWAN simulations.
swan/S0: Input and output files for the open water baseline scenario (S0). These runs include only wind-forced waves, with no ice effects.
swan/S2_f5: Input and output files for the full ice-influenced scenario, where frazil/grease ice and a dissipation exponent n=5 are applied.
⚠️ These folders also contain several GBs of SWAN output files (.mat, .dat, .sp1, .sp2). These are not needed for this tutorial, so we will copy only the .swn input files along with the contents of input/.

3. We will be using the data inside the `swan` folder, which includes:
Here is what these folders contain:

* ´swan/input´: contains the input grids, wind fields, and ice concentration maps
for all ten polynya events. These are the raw fields you’ll use in your SWAN 
simulations.

* ´swan/S0´: This folder contains SWAN input files and outputs for the baseline
"open water" scenario. Corresponds to the S0 experiments in the paper: no ice, 
only wind-forced waves. 

* ´swan/S2_f5´: Contains SWAN input files and outputs for a polynya/frazil ice 
scenario, with a specific ice dissipation exponent n = 5. This matches the 
S2_f5 experiments discussed in the paper (Scenario 2, ice power-law exponent = 5).

Besides several .swn input files, folders ´swan/S0´ and ´swan/S2_f5´ also contain 
dozen of large output files (.mat, .dat, .sp1, .sp2) that are generated by those 
simulations, and which the authers are also disbributing for reproducibility purposes. 
Since, these amounting to several GBs and we will not need those, so we will now copy
only the required SWAN input files to a new project directory.

Please copy the ´input´ folder and only the ´.swn´ files inside 
´swan/S0´ and ´swan/S2_f5´ to a ´tutorial´ folder  with the following structure.


```
tutorial
   |
   + polynya
      |
      + S0
      |  |
      |  + polynya2D_20161005.swn
      |  |	
      |  + polynya2D_20161024.swn
      |  |
      |  ...
      |  |
      |  + polynya2D_20201019.swn
      |
      |
      + S2_f5
      |  |
      |  + polynya2D_20161005.swn
      |  |	
      |  + polynya2D_20161024.swn
      |  |
      |  ...
      |  |
      |  + polynya2D_20201019.swn
      |
      + input
         |
         + Aice0_20161005_dx200.dat 
         |
         ...
         |
         + wnd_20211007_10m.dat
```

All the data is in place. Let's now move to prepare the Python script to run the baseline S0 scenario.

## Running the SWAN simulation
The following script, that needs to be placed inside directory `tutorial`, runs 
the simulation S0/polynya2D_20211007.swn:

```python
"""SWAN example"""
import inductiva

# Allocate cloud machine on Google Cloud Platform
cloud_machine = inductiva.resources.MachineGroup( \
    provider="GCP",
    machine_type="c4d-highcpu-48",
    threads_per_core=1,
    data_disk_gb=20,
    spot=True)

# Initialize the Simulator
swan = inductiva.simulators.SWAN()

# Run simulation
task = swan.run(input_dir="polynya",
    sim_config_filename="S2_f5/polynya2D_20211007.swn",
    on=cloud_machine)

# Wait for the simulation to finish and download the results
task.wait()
cloud_machine.terminate()

task.print_summary()
```

In this example, we're using a `c4d-highcpu-32` machine, based on 5th Gen AMD EPYC processors (2024), equipped with 32 virtual CPUs. For larger or more compute-intensive simulations, consider adjusting the `machine_type` parameter to select 
a machine with more virtual CPUs and increased memory capacity. You can explore the full range of available machines [here](https://console.inductiva.ai/machine-groups/instance-types).

> **Note**: Setting `spot=True` enables the use of [spot machines](../how-it-works/machines/spot-machines.md), which are available at substantial discounts. 
> However, your simulation may be interrupted if the cloud provider reclaims the machine.

When the simulation is complete, we terminate the machine, download the results and print a summary of the simulation as shown below.

```
Task status: Success

Timeline:
	Waiting for Input         at 05/10, 10:54:03      1.262 s
	In Queue                  at 05/10, 10:54:04      50.123 s
	Preparing to Compute      at 05/10, 10:54:54      6.886 s
	In Progress               at 05/10, 10:55:01      12956.885 s
		├> 1.068 s         dd if=/dev/stdin of=machinefile
		└> 12955.593 s     swanrun -input polynya2D_20211007.swn -mpi 32
	Finalizing                at 05/10, 14:30:58      6.567 s
	Success                   at 05/10, 14:31:04      

Data:
	Size of zipped output:    930.15 MB
	Size of unzipped output:  1.92 GB
	Number of output files:   180

Estimated Task Compute Cost = 2.01 US$
Task Orchestration Fee = 0.01 US$
Total Estimated Cost = 2.02 US$
Learn more about costs at: https://inductiva.ai/guides/how-it-works/basics/how-much-does-it-cost
```

As you can see in the "In Progress" line, the part of the timeline that represents the actual execution of the simulation, 
the core computation time of this simulation was .

To adapt this script for the S2_f5 or other scenario, set the `sim_config_filename` accordingly.

### Scaling Up Your Simulation  
Scaling up your simulation is as simple as updating the `machine_type` parameter to a higher vCPU machine. To demonstrate this, we'll double up the vCPUs on the previous machine, by using the c4d-highcpu-64.

Here are the results of running the two defined scenarions on these machines:

(table in markdown with scenario, execution time, estimated cost and machine type

s0
---

32 vcpus:

Reference time / cost: 3h36 / 2.00 US$

64 vcpus:

Reference time / cost: 2h26 / 2.70 US$

s2
---
32 vcpus: 
Reference time / cost: 2h37 / 1.45 US$

48 vcpus: 
Reference time: 1h58 / cost: 1.64 US$ 

64 vcpus : 

Reference time / cost: 1h42 / 1.89 US$

96 vcpus: 

Reference time / cost:  1h34 /  2.60 US$



)



```{banner_small}
:origin: swan
```
