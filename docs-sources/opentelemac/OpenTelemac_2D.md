# Run Your First Simulation
This tutorial will show you how to run OpenTelemac simulations using the Inductiva API. 

We will cover the `Malpasset Dam Break` scenario, one of the most well-known benchmarks for validating flood modeling using TELEMAC-2D, this setup models the flood wave caused by the dam failure, propagating through a valley using realistic topography and open-channel hydraulics. The use case is included in the official OpenTelemac suite under [`examples/telemac2d/malpasset`](https://gitlab.pam-retd.fr/otm/telemac-mascaret/-/tree/main/examples/telemac2d/malpasset?ref_type=heads).

## Prerequisites
Download the required files [here](https://storage.googleapis.com/inductiva-api-demo-files/opentelemac-input-example.zip) and unzip them. The files will be located in a folder named `opentelemac-input-example`.

This folder should contain the following:
- `t2d_malpasset-fine.cas`
- Mesh and geometry files, such as`geo_malpasset.slf`, etc. 
- `Optional`: boundary condition and results configuration files


## Running a TELEMAC-2D Simulation

OpenTelemac simulations using the Inductiva API consist of a **single execution step**. The simulation is configured via `.cas` steering files and any additional `.slf`, `.cli`, or `.bc` files.

### .cas File

The .cas file is the heart of an OpenTelemac simulation ‚Äî it tells the solver what to do. In this case, t2d_malpasset-fine.cas configures the Malpasset dam break run.

Here‚Äôs what it controls:

- **Input/Output**: Specifies the geometry, boundary conditions, and result filenames.
- **Simulation Setup**: Sets initial conditions, total simulation time (4000s), and a variable time step using a Courant condition.
- **Physical Properties**: Includes bottom friction (Manning‚Äôs coefficient), turbulence modeling, and velocity diffusivity.
- **Numerical Scheme**: Uses the Saint-Venant equations with a first-order kinetic finite volume scheme ‚Äî well-suited for handling shocks and dry-bed wetting (enabled with TIDAL FLATS = YES).

A few key lines from the `.cas`:

```
GEOMETRY FILE            = geo_malpasset-large.slf
BOUNDARY CONDITIONS FILE = geo_malpasset-large.cli
RESULTS FILE             = r2d_malpasset-fine.slf
EQUATIONS                = 'SAINT-VENANT FV'
FINITE VOLUME SCHEME     = 1
TIDAL FLATS              = YES
```



### Code example

Here is the code required to run a OpenTelemac simulation using the Inductiva API:

```python
"""OpenTelemac example: Malpasset dam break"""
import inductiva

# Allocate cloud machine on Google Cloud Platform
cloud_machine = inductiva.resources.MachineGroup(
    provider="GCP",
    machine_type="c4-standard-32",
    spot=True)

# Initialize the Simulator
telemac2d = inductiva.simulators.OpenTelemac( \
    version="8p4r0")


# Commands to run the simulation
commands = [
	"telemac2d.py t2d_malpasset-fine.cas --ncsize=32", # Run the simulation using 32 cores
	"converter.py srf2vtk r2d_malpasset-fine.slf t2d_malpasset.vtk", # Convert the results to VTK format
]

# Run simulation
task = telemac2d.run(
    input_dir="/Path/to/opentelemac-input-example",
	commands=commands,
    on=cloud_machine)

# Wait for the simulation to finish and download the results
task.wait()
cloud_machine.terminate()

task.download_outputs()
task.print_summary()

```

Since this is a 2D simulation, we use the telemac2d.py command-line script, which is the dedicated runner for TELEMAC-2D models. You can think of it as the solver frontend that reads your .cas steering file and orchestrates the simulation.

In the command:

```
telemac2d.py t2d_malpasset-fine.cas --ncsize=32
```

- `t2d_malpasset-fine.cas` is the steering file that contains all the simulation settings.
- `--ncsize=32` tells TELEMAC to run the simulation in parallel using 32 cores. This value should match the number of vCPUs allocated to the machine.



‚ö†Ô∏è If you don't include --ncsize, TELEMAC will default to single-core execution, which can significantly slow down large simulations.

The general command structure for running any TELEMAC simulation is:


```
solver (script) <steering_file> --ncsize=<number_of_cores>
```

Finally, the second command in the list:

```
converter.py srf2vtk r2d_malpasset-fine.slf t2d_malpasset.vtk
```

converts the result file from Serafin format (.slf) to VTK format (.vtk), which you can open in tools like ParaView to visualize depth, velocity, and flood propagation over time.

<p align="center"><img src="./_static/malpasset_water_depth.gif" alt="Malpasset Dam Break Water Depth Animation with Paraview using VTK files generated by OpenTelemac" width="700"></p>


When the simulation is complete, we terminate the machine, download the results and print a summary of the simulation as shown below.

```
Task status: Success

Timeline:
	Waiting for Input         at 10/04, 12:16:39      0.949 s
	In Queue                  at 10/04, 12:16:40      54.596 s
	Preparing to Compute      at 10/04, 12:17:35      2.629 s
	In Progress               at 10/04, 12:17:37      161.693 s
		‚îî> 152.232 s       telemac2d.py t2d_malpasset-fine.cas --ncsize=32
		‚îî> 8.087 s         converter.py srf2vtk r2d_malpasset-fine.slf t2d_malpasset.vtk
	Finalizing                at 10/04, 12:25:10      1.207 s
	Success                   at 10/04, 12:25:11      

Data:
	Size of zipped output:    18.17 MB
	Size of unzipped output:  24.24 MB
	Number of output files:   5

Estimated computation cost (US$): 0.032 US$
```
As you can see in the "In Progress" line, the part of the timeline that represents the actual execution of the simulation, 
the core computation time of this simulation was approximately 161.693 seconds (around 2 minutes and 42 seconds).


This simulation captures the evolution of a flood wave in a real valley ‚Äî a powerful example of TELEMAC-2D‚Äôs capability to solve complex free-surface flows over dry and wet domains.

It's that simple!
Let the cloud do the heavy lifting ‚Äî and focus your time on insights instead of infrastructure. üöÄ


